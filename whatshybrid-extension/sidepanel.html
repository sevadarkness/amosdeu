<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsHybrid Pro v7.5.5 - Side Panel</title>
    <link rel="stylesheet" href="sidepanel.css">
    <link rel="stylesheet" href="onboarding.css">
    <link rel="stylesheet" href="modules/modules.css">
</head>
<body>
    <div class="container">
        <!-- ========================================
             HEADER
        ======================================== -->
        <header class="header">
            <div class="logo">
                <img src="icons/48.png" alt="WhatsHybrid logo" class="logo-icon-img">
                <h1 id="spHeaderTitle">WhatsHybrid</h1>
            </div>
            <div class="header-actions">
                <button id="btnOpenCrmFullscreen" class="btn-icon-header" title="Abrir CRM em Nova Aba" style="font-size: 16px;">
                    ğŸ“Š
                </button>
                <button id="btnViewHistory" class="btn-icon-header" title="Ver HistÃ³rico (Ctrl+H)">
                    ğŸ“œ
                </button>
                <span class="version">v7.5.5</span>
            </div>
        </header>

        <!-- ========================================
             WHL FUSION: VIEW ROOT (dynamic content)
        ======================================== -->
        <div id="whlViewRoot" class="whl-view-root">

            <!-- ============ VIEW: PRINCIPAL ============ -->
            <section id="whlViewPrincipal" class="whl-view">
  <div class="sp-card">
    <div class="sp-title">ğŸ“¨ Disparo de mensagens â€” Envio em massa</div>
    <div class="sp-muted">Cole os nÃºmeros, escreva a mensagem, anexe uma imagem (opcional), gere a tabela e inicie a campanha.</div>

    <label class="sp-label">ğŸ“± NÃºmeros (um por linha)</label>
    <textarea id="sp_numbers" class="sp-textarea" placeholder="5511999998888&#10;5511988887777"></textarea>

    <div class="sp-row" style="margin-top:8px;align-items:center">
      <input id="sp_csv" type="file" accept=".csv,text/csv" style="display:none" />
      <button id="sp_select_csv" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“Š Importar CSV</button>
      <button id="sp_clear_csv" class="sp-btn sp-btn-danger" style="display:none">ğŸ—‘ï¸ Remover</button>
    </div>
    
    <div class="sp-row" style="margin-top:8px;align-items:center">
      <input id="sp_excel_file" type="file" accept=".xlsx,.xls" style="display:none" />
      <button id="sp_import_excel" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“Š Importar Excel</button>
    </div>
    
    <div id="sp_csv_hint" class="sp-status"></div>

    <label class="sp-label" style="margin-top:10px">ğŸ’¬ Mensagem</label>
    
    <div style="position:relative">
      <textarea id="sp_message" class="sp-textarea" style="min-height:120px;padding-right:56px" placeholder="Digite a mensagem..."></textarea>
      <button id="sp_emoji_btn" class="sp-btn sp-btn-secondary" style="position:absolute;right:8px;bottom:8px;padding:6px 10px">ğŸ˜Š</button>
      <div id="sp_emoji_picker" style="display:none;position:absolute;right:8px;bottom:50px;z-index:10;background:rgba(0,0,0,0.60);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.12);border-radius:12px;padding:8px;max-width:260px"></div>
    </div>

    <div class="sp-row" style="margin-top:8px;align-items:center">
      <input id="sp_image" type="file" accept="image/*" style="display:none" />
      <button id="sp_select_image" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“ Anexar imagem</button>
    </div>
    <div class="sp-row" style="gap:6px">
      <input id="sp_audio_file" type="file" accept="audio/*,.mp3,.ogg,.wav,.m4a" style="display:none" />
      <button id="sp_attach_audio" class="sp-btn sp-btn-secondary" style="flex:1">ğŸµ Anexar Ãudio/MP3</button>
      <button id="sp_select_file" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“ Anexar Arquivo</button>
      <button id="sp_clear_image" class="sp-btn sp-btn-danger" style="display:none">ğŸ—‘ï¸ Remover</button>
    </div>
    <div id="sp_image_hint" class="sp-status"></div>

    <div class="sp-row" style="margin-top:8px">
      <button id="sp_save_message" class="sp-btn sp-btn-secondary">ğŸ’¾ Salvar Mensagem</button>
    </div>

    <div class="sp-title" style="font-size:13px;margin-top:10px">ğŸ“± Preview</div>
    <div class="wa-chat">
      <div class="wa-bubble">
        <img id="sp_preview_img" src="" style="display:none;max-width:100%;border-radius:10px;margin-bottom:8px" />
        <div id="sp_preview_text" style="white-space:pre-wrap;word-break:break-word"></div>
        <div class="wa-time">
          <span id="sp_preview_meta"></span>
          <span class="wa-ticks">âœ“âœ“</span>
        </div>
      </div>
    </div>

    <div class="sp-row" style="margin-top:10px">
      <button id="sp_build_queue" class="sp-btn sp-btn-primary" style="flex:1">ğŸ“‹ Gerar tabela</button>
      <button id="sp_clear_fields" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ§¹ Limpar</button>
    </div>

    <div id="sp_hint" class="sp-status"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸš€ Campanha</div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <div style="flex:1;min-width:90px;background:rgba(0,0,0,0.10);border:1px solid rgba(255,255,255,0.10);border-radius:12px;padding:8px">
        <div class="sp-muted" style="font-size:10px">âœ… Enviadas</div>
        <div id="sp_stat_sent" style="font-size:16px;font-weight:900">0</div>
      </div>
      <div style="flex:1;min-width:90px;background:rgba(0,0,0,0.10);border:1px solid rgba(255,255,255,0.10);border-radius:12px;padding:8px">
        <div class="sp-muted" style="font-size:10px">âŒ Falhas</div>
        <div id="sp_stat_failed" style="font-size:16px;font-weight:900">0</div>
      </div>
      <div style="flex:1;min-width:90px;background:rgba(0,0,0,0.10);border:1px solid rgba(255,255,255,0.10);border-radius:12px;padding:8px">
        <div class="sp-muted" style="font-size:10px">â³ Pendentes</div>
        <div id="sp_stat_pending" style="font-size:16px;font-weight:900">0</div>
      </div>
    </div>

    <div style="margin-top:10px">
      <div class="sp-muted" id="sp_progress_text">0%</div>
      <div style="height:10px;background:rgba(255,255,255,0.10);border-radius:999px;overflow:hidden">
        <div id="sp_progress_fill" style="height:100%;width:0%;background:rgba(37,211,102,0.85)"></div>
      </div>
      <div class="sp-muted" id="sp_estimated_time" style="margin-top:6px"></div>
    </div>

    <div class="sp-row" style="margin-top:10px">
      <button id="sp_start" class="sp-btn sp-btn-primary" style="flex:1">â–¶ï¸ Iniciar</button>
      <button id="sp_pause" class="sp-btn sp-btn-secondary" style="flex:1">â¸ï¸ Pausar</button>
      <button id="sp_stop" class="sp-btn sp-btn-danger" style="flex:1">â¹ï¸ Parar</button>
    </div>

    <div id="sp_campaign_status" class="sp-status"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“‹ Tabela / Fila</div>
    <div class="sp-muted" id="sp_queue_meta">0 contatos</div>

    <div class="sp-queue-container" style="margin-top:8px">
      <table>
        <thead>
          <tr>
            <th style="width:44px">#</th>
            <th>NÃºmero</th>
            <th style="width:92px">Status</th>
            <th style="width:70px">AÃ§Ã£o</th>
          </tr>
        </thead>
        <tbody id="sp_queue_table"></tbody>
      </table>
    </div>

    <div class="sp-row" style="margin-top:10px">
      <button id="sp_skip" class="sp-btn sp-btn-secondary" style="flex:1">â­ï¸ Pular atual</button>
      <button id="sp_wipe" class="sp-btn sp-btn-danger" style="flex:1">ğŸ§¨ Zerar fila</button>
    </div>
  </div>

  <!-- ============ CARD: AUTO-PILOT - REMOVED per v7.6.0 requirements ============ -->
  <!-- All autopilot functionality has been moved to the dedicated Autopilot tab -->
</section>

            <!-- ============ VIEW: EXTRATOR ============ -->
            <section id="whlViewExtrator" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">ğŸ“¥ Extrator de contatos</div>
    <div class="sp-muted">Extrai contatos Normais, Arquivados e Bloqueados do WhatsApp Web.</div>

    <div class="sp-row">
      <button id="sp_extract_contacts" class="sp-btn sp-btn-primary">ğŸ“¥ Extrair</button>
      <button id="sp_refresh_extract" class="sp-btn sp-btn-secondary">ğŸ”„ Atualizar</button>
      <button id="sp_copy_extract_all" class="sp-btn sp-btn-secondary">ğŸ“‹ Copiar Todos</button>
    </div>

    <div id="sp_extract_status" class="sp-status">Pronto.</div>

    <div style="margin-top:10px">
      <div class="sp-title" style="font-size:13px">âœ… Normais (<span id="sp_count_normal">0</span>)</div>
      <textarea id="sp_normal_list" class="sp-textarea"></textarea>
      <div class="sp-row" style="margin-top:6px">
        <button id="sp_copy_normal" class="sp-btn sp-btn-secondary">ğŸ“‹ Copiar Normais</button>
      </div>

      <div class="sp-title" style="font-size:13px;margin-top:12px">ğŸ“ Arquivados (<span id="sp_count_archived">0</span>)</div>
      <textarea id="sp_archived_list" class="sp-textarea"></textarea>
      <div class="sp-row" style="margin-top:6px">
        <button id="sp_copy_archived" class="sp-btn sp-btn-secondary">ğŸ“‹ Copiar Arquivados</button>
      </div>

      <div class="sp-title" style="font-size:13px;margin-top:12px">â›” Bloqueados (<span id="sp_count_blocked">0</span>)</div>
      <textarea id="sp_blocked_list" class="sp-textarea"></textarea>
      <div class="sp-row" style="margin-top:6px">
        <button id="sp_copy_blocked" class="sp-btn sp-btn-secondary">ğŸ“‹ Copiar Bloqueados</button>
      </div>
    </div>
  </div>
</section>

            <!-- ============ VIEW: GRUPOS (V6 - EXISTENTE) ============ -->
            <section id="whlViewGroups" class="whl-view hidden">


        <!-- ========================================
             BARRA DE STATUS
        ======================================== -->
        <div id="statusBar" class="status-bar hidden">
            <span id="statusText">Aguardando...</span>
            <div id="progressBar" class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
                <span class="progress-text" id="progressPercent">0%</span>
            </div>
            <!-- Controles de extraÃ§Ã£o -->
            <div id="extractionControls" class="extraction-controls hidden">
                <button id="btnPauseExtraction" class="btn-control btn-control-pause" title="Pausar extraÃ§Ã£o">
                    â¸ï¸ Pausar
                </button>
                <button id="btnResumeExtraction" class="btn-control btn-control-resume hidden" title="Continuar extraÃ§Ã£o">
                    â–¶ï¸ Continuar
                </button>
                <button id="btnStopExtraction" class="btn-control btn-control-stop" title="Parar extraÃ§Ã£o">
                    â¹ï¸ Parar
                </button>
            </div>
        </div>

        <!-- ========================================
             ETAPA 1: CARREGAR GRUPOS
        ======================================== -->
        <section id="step1" class="step">
            <!-- Dica de reconexÃ£o SEMPRE VISÃVEL -->
            <div class="tip-bubble tip-info" id="connectionTip">
                <div class="tip-content">
                    ğŸ’¡ Se "Carregar Grupos" nÃ£o funcionar, <strong>clique no Ã­cone da extensÃ£o</strong> (ğŸ§©) para reconectar.
                </div>
            </div>

            <!-- NOVO: Dica de reconexÃ£o (oculta por padrÃ£o) -->
            <div class="tip-bubble tip-warning" id="reconnectTip" style="display: none;">
                <div class="tip-content">
                    âš ï¸ ConexÃ£o perdida. <strong>Clique no Ã­cone da extensÃ£o</strong> (ğŸ§©) para reconectar.
                </div>
            </div>

            <button id="btnLoadGroups" class="btn btn-primary btn-large">
                <span class="btn-icon">ğŸ“‚</span>
                Carregar Grupos
            </button>
            
            <button id="btnForceRefresh" class="btn btn-secondary" style="margin-top:8px;display:none">
                <span class="btn-icon">ğŸ”„</span>
                ForÃ§ar AtualizaÃ§Ã£o
            </button>

            <!-- Atalhos -->
            <div class="shortcuts-box">
                <p class="shortcuts-title">âŒ¨ï¸ Atalhos:</p>
                <ul class="shortcuts-list">
                    <li><kbd>Ctrl+L</kbd> Carregar grupos</li>
                    <li><kbd>Ctrl+H</kbd> Ver histÃ³rico</li>
                    <li><kbd>Ctrl+F</kbd> Buscar grupo</li>
                </ul>
            </div>
        </section>

        <!-- ========================================
             ETAPA 2: SELECIONAR GRUPO
        ======================================== -->
        <section id="step2" class="step hidden">
            <div class="groups-header">
                <h2>Selecione um Grupo</h2>
                <span id="groupCount" class="badge">0 grupos</span>
            </div>

            <!-- EstatÃ­sticas -->
            <div id="groupStats" class="group-stats">
                <div class="stat-item" id="statTotal">
                    <span class="stat-icon">ğŸ“Š</span>
                    <div class="stat-info">
                        <span class="stat-label">Total:</span>
                        <span class="stat-value">0</span>
                        <span class="stat-unit">grupos</span>
                    </div>
                </div>
                
                <!-- SEPARADOR 1 - Entre Total e Ativos -->
                <div class="stats-separator"></div>
                
                <div class="stat-item" id="statActive">
                    <span class="stat-icon">âœ…</span>
                    <div class="stat-info">
                        <span class="stat-label">Ativos:</span>
                        <span class="stat-value">0</span>
                    </div>
                </div>
                
                <!-- SEPARADOR 2 - Entre Ativos e Arquivados -->
                <div class="stats-separator"></div>
                
                <div class="stat-item" id="statArchived">
                    <span class="stat-icon">ğŸ“¦</span>
                    <div class="stat-info">
                        <span class="stat-label">Arquivados:</span>
                        <span class="stat-value">0</span>
                    </div>
                </div>
            </div>

            <!-- Filtros por abas -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    <span class="tab-icon">ğŸ“‹</span> Todos
                </button>
                <button class="filter-tab" data-filter="active">
                    <span class="tab-icon">ğŸ’¬</span> Ativos
                </button>
                <button class="filter-tab" data-filter="archived">
                    <span class="tab-icon">ğŸ“¦</span> Arquivados
                </button>
            </div>

            <!-- Campo de busca -->
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input 
                    type="text" 
                    id="searchGroups" 
                    placeholder="Filtrar grupos..." 
                    autocomplete="off" 
                />
            </div>

            <!-- Lista de grupos (Virtual Scroll) -->
            <div id="groupsList" class="groups-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando grupos...</p>
                </div>
            </div>

            <!-- AÃ§Ãµes -->
            <div class="actions">
                <button id="btnBack" class="btn btn-secondary">
                    â† Voltar
                </button>
                <button id="btnExtract" class="btn btn-primary" disabled>
                    <span class="btn-icon">ğŸ“¥</span>
                    Extrair Membros
                </button>
            </div>
        </section>

        <!-- ========================================
             ETAPA 3: RESULTADO
        ======================================== -->
        <section id="step3" class="step hidden">
            <div class="result-header">
                <span class="result-icon">âœ…</span>
                <h2>ExtraÃ§Ã£o ConcluÃ­da!</h2>
            </div>

            <!-- InformaÃ§Ãµes do resultado -->
            <div class="result-info">
                <div class="result-item">
                    <span class="label">Grupo:</span>
                    <span id="resultGroupName" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Status:</span>
                    <span id="resultGroupStatus" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Membros:</span>
                    <span id="resultMemberCount" class="value">-</span>
                </div>
            </div>

            <!-- Lista de membros extraÃ­dos (Virtual Scroll) -->
            <div class="members-container">
                <h3 class="members-title">
                    <span class="members-icon">ğŸ‘¥</span>
                    Membros ExtraÃ­dos
                </h3>
                <div id="membersList" class="members-list">
                    <!-- Membros serÃ£o inseridos aqui via Virtual Scroll -->
                </div>
            </div>

            <!-- BotÃµes de exportaÃ§Ã£o -->
            <div class="export-buttons">
                <button id="btnExportCSV" class="btn btn-export" title="Exportar como CSV (Ctrl+S)">
                    ğŸ“„ CSV
                </button>
                <button id="btnCopyList" class="btn btn-export" title="Copiar lista">
                    ğŸ“‹ Copiar
                </button>
            </div>

            <!-- BotÃµes Google Sheets -->
            <div class="sheets-buttons">
                <button id="btnCopySheets" class="btn btn-sheets" title="Copiar para Google Sheets (Ctrl+G)">
                    <span class="btn-icon">ğŸ“Š</span> Copiar para Sheets
                </button>
                <button id="btnOpenSheets" class="btn btn-sheets-outline" title="Abrir no Google Sheets">
                    <span class="btn-icon">ğŸ”—</span> Abrir no Sheets
                </button>
            </div>

            <!-- BotÃ£o nova extraÃ§Ã£o -->
            <button id="btnNewExtraction" class="btn btn-secondary btn-large">
                ğŸ”„ Nova ExtraÃ§Ã£o
            </button>
        </section>

        <!-- ========================================
             ETAPA 4: HISTÃ“RICO
        ======================================== -->
        <section id="step4" class="step hidden">
            <div class="history-header">
                <h2>ğŸ“œ HistÃ³rico de ExtraÃ§Ãµes</h2>
            </div>

            <!-- EstatÃ­sticas do histÃ³rico -->
            <div id="historyStats" class="history-stats">
                <!-- Stats serÃ£o inseridas dinamicamente -->
            </div>

            <!-- Lista do histÃ³rico -->
            <div id="historyList" class="history-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando histÃ³rico...</p>
                </div>
            </div>

            <!-- AÃ§Ãµes do histÃ³rico -->
            <div class="actions">
                <button id="btnBackFromHistory" class="btn btn-secondary">
                    â† Voltar
                </button>
                <button id="btnClearHistory" class="btn btn-danger">
                    ğŸ—‘ï¸ Limpar Tudo
                </button>
            </div>
        </section>

        <!-- ========================================
             MENSAGEM DE ERRO
        ======================================== -->
        <div id="errorBox" class="error-box hidden">
            <span class="error-icon">âš ï¸</span>
            <span id="errorText" class="error-text">Erro desconhecido</span>
            <button id="btnDismissError" class="btn-dismiss" title="Fechar">
                âœ•
            </button>
        </div>

            </section>

            <!-- ============ VIEW: RECOVER ============ -->
                                    <section id="whlViewRecover" class="whl-view hidden">
  <!-- Header -->
  <div class="sp-card" style="background: linear-gradient(135deg, #00a884 0%, #008f6f 100%); border: none;">
    <div style="display: flex; align-items: center; gap: 12px;">
      <span style="font-size: 32px;">ğŸ”„</span>
      <div>
        <div style="font-size: 18px; font-weight: 700; color: white;">Recover v7.5.0</div>
        <div style="font-size: 12px; color: rgba(255,255,255,0.8);">Recupera mensagens apagadas, editadas e revogadas</div>
      </div>
    </div>
  </div>

  <!-- EstatÃ­sticas -->
  <div class="sp-card">
    <div style="display: flex; flex-wrap: wrap; gap: 6px; justify-content: space-between;">
      <div style="flex: 1; min-width: 55px; padding: 6px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; text-align: center;">
        <div style="font-size: 16px; font-weight: 700; color: #ef4444;" id="stat_revoked">0</div>
        <div style="font-size: 9px; color: var(--mod-text-muted);">Revogadas</div>
      </div>
      <div style="flex: 1; min-width: 55px; padding: 6px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; text-align: center;">
        <div style="font-size: 16px; font-weight: 700; color: #f59e0b;" id="stat_deleted">0</div>
        <div style="font-size: 9px; color: var(--mod-text-muted);">Apagadas</div>
      </div>
      <div style="flex: 1; min-width: 55px; padding: 6px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; text-align: center;">
        <div style="font-size: 16px; font-weight: 700; color: #3b82f6;" id="stat_edited">0</div>
        <div style="font-size: 9px; color: var(--mod-text-muted);">Editadas</div>
      </div>
      <div style="flex: 1; min-width: 55px; padding: 6px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; text-align: center;">
        <div style="font-size: 16px; font-weight: 700; color: #8b5cf6;" id="stat_media">0</div>
        <div style="font-size: 9px; color: var(--mod-text-muted);">MÃ­dias</div>
      </div>
      <div style="flex: 1; min-width: 55px; padding: 6px; background: rgba(251, 191, 36, 0.1); border-radius: 8px; text-align: center;">
        <div style="font-size: 16px; font-weight: 700; color: #fbbf24;" id="stat_favorites">0</div>
        <div style="font-size: 9px; color: var(--mod-text-muted);">â­ Favoritos</div>
      </div>
    </div>
  </div>

  <!-- Controles Principais -->
  <div class="sp-card">
    <div class="sp-row" style="gap: 6px;">
      <button id="sp_refresh_recover" class="sp-btn sp-btn-primary" style="flex:1;padding:8px">ğŸ”„ Atualizar</button>
      <button id="recover_sync_backend" class="sp-btn sp-btn-secondary" style="flex:1;padding:8px">â˜ï¸ Sync</button>
      <button id="sp_clear_recover" class="sp-btn sp-btn-danger" style="padding:8px">ğŸ—‘ï¸</button>
    </div>
    
    <!-- FASE 4: Novos botÃµes de Snapshot e Deep Scan -->
    <div class="sp-row" style="margin-top:8px;gap: 6px;">
      <button id="recover_snapshot" class="sp-btn sp-btn-secondary" style="flex:1;padding:8px" title="Capturar snapshot inicial de todas as mensagens">ğŸ“¸ Snapshot</button>
      <button id="recover_deep_scan" class="sp-btn sp-btn-secondary" style="flex:1;padding:8px" title="Fazer varredura profunda com loadEarlierMsgs">ğŸ”¬ Deep Scan</button>
    </div>
    
    <!-- Filtros por Tipo -->
    <div class="sp-row" style="margin-top:10px;gap:4px;flex-wrap:wrap">
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter active" data-filter="all" style="padding:5px 10px;font-size:10px">ğŸ“‹ Todos</button>
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter" data-filter="revoked" style="padding:5px 10px;font-size:10px">ğŸš« Revogadas</button>
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter" data-filter="deleted" style="padding:5px 10px;font-size:10px">ğŸ—‘ï¸ Apagadas</button>
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter" data-filter="edited" style="padding:5px 10px;font-size:10px">âœï¸ Editadas</button>
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter" data-filter="media" style="padding:5px 10px;font-size:10px">ğŸ“ MÃ­dia</button>
      <button class="sp-btn sp-btn-secondary sp-btn-sm recover-filter" data-filter="favorites" style="padding:5px 10px;font-size:10px">â­ Favoritos</button>
    </div>
    
    <!-- Busca + Filtro por Chat -->
    <div class="sp-row" style="margin-top:8px;gap:6px">
      <input type="text" id="recover_search" class="sp-input" placeholder="ğŸ” Buscar por nÃºmero..." style="flex:1;padding:8px;font-size:12px">
      <select id="recover_chat_filter" class="sp-input" style="width:120px;padding:8px;font-size:11px">
        <option value="">Todos chats</option>
      </select>
    </div>
    
    <!-- ExportaÃ§Ã£o -->
    <div class="sp-row" style="margin-top:8px;gap:4px">
      <button id="recover_export_csv" class="sp-btn sp-btn-secondary sp-btn-sm" style="flex:1;padding:6px;font-size:10px">ğŸ“Š CSV</button>
      <button id="recover_export_txt" class="sp-btn sp-btn-secondary sp-btn-sm" style="flex:1;padding:6px;font-size:10px">ğŸ“ TXT</button>
      <button id="recover_export_pdf" class="sp-btn sp-btn-secondary sp-btn-sm" style="flex:1;padding:6px;font-size:10px">ğŸ“„ PDF</button>
      <button id="sp_download_all_recover" class="sp-btn sp-btn-secondary sp-btn-sm" style="flex:1;padding:6px;font-size:10px">ğŸ’¾ JSON</button>
    </div>
  </div>

  <!-- ConfiguraÃ§Ãµes de NotificaÃ§Ã£o -->
  <div class="sp-card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="sp-title" style="margin:0;font-size:13px">ğŸ”” NotificaÃ§Ãµes Desktop</div>
      <label style="display:flex;align-items:center;gap:6px;font-size:11px">
        <input type="checkbox" id="recover_notifications_enabled" style="width:16px;height:16px">
        <span>Ativar</span>
      </label>
    </div>
    <div class="sp-row" style="margin-top:8px;gap:6px">
      <input type="text" id="recover_notify_contact" class="sp-input" placeholder="NÃºmero especÃ­fico (ex: 5521...)" style="flex:1;padding:6px;font-size:11px">
      <button id="recover_add_notify_contact" class="sp-btn sp-btn-secondary sp-btn-sm" style="padding:6px 10px">â•</button>
    </div>
    <div id="recover_notify_contacts_list" style="margin-top:6px;font-size:10px;color:var(--mod-text-muted)"></div>
  </div>

  <!-- Timeline -->
  <div class="sp-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="sp-title" style="margin:0;font-size:13px">ğŸ“œ HistÃ³rico</div>
      <div class="sp-muted" style="font-size:11px">Total: <b id="sp_recover_total">0</b></div>
    </div>
    
    <div id="sp_recover_status" class="sp-status" style="margin-bottom:8px;font-size:11px">Pronto.</div>
    
    <div id="sp_recover_timeline" class="timeline-container" style="max-height:350px;overflow-y:auto"></div>
    
    <!-- PaginaÃ§Ã£o -->
    <div class="sp-row" style="margin-top:8px;justify-content:center;gap:8px;align-items:center">
      <button id="recover_prev_page" class="sp-btn sp-btn-secondary sp-btn-sm" style="padding:4px 10px;font-size:10px">â—€ Anterior</button>
      <span id="recover_page_info" class="sp-muted" style="font-size:10px">PÃ¡gina 1 de 1</span>
      <button id="recover_next_page" class="sp-btn sp-btn-secondary sp-btn-sm" style="padding:4px 10px;font-size:10px">PrÃ³xima â–¶</button>
    </div>
  </div>

  <!-- Modal de ComparaÃ§Ã£o de EdiÃ§Ãµes -->
  <div id="recover_compare_modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:9999;padding:20px">
    <div style="background:var(--mod-card-bg);border-radius:12px;max-width:600px;margin:50px auto;padding:20px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <div style="font-size:16px;font-weight:600">ğŸ“ Comparar VersÃµes</div>
        <button id="recover_close_compare" style="background:none;border:none;font-size:20px;cursor:pointer">âœ•</button>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
        <div>
          <div style="font-size:12px;color:#ef4444;margin-bottom:5px">âŒ Original (Apagado)</div>
          <div id="recover_compare_original" style="background:rgba(239,68,68,0.1);padding:10px;border-radius:8px;font-size:13px;min-height:80px"></div>
        </div>
        <div>
          <div style="font-size:12px;color:#10b981;margin-bottom:5px">âœ… Editado (Atual)</div>
          <div id="recover_compare_edited" style="background:rgba(16,185,129,0.1);padding:10px;border-radius:8px;font-size:13px;min-height:80px"></div>
        </div>
      </div>
      <div id="recover_compare_diff" style="margin-top:15px;padding:10px;background:rgba(59,130,246,0.1);border-radius:8px;font-size:11px"></div>
    </div>
  </div>
</section>

            <!-- ============ VIEW: CONFIG ============ -->
            <section id="whlViewConfig" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">âš™ï¸ ConfiguraÃ§Ãµes</div>
    <div class="sp-muted">Ajuste delays, agendamento, templates e relatÃ³rio (igual ao mÃ³dulo original).</div>

    <label class="sp-label">â±ï¸ Delay mÃ­nimo (segundos)</label>
    <input id="sp_delay_min" type="number" class="sp-input" min="0" step="0.5" placeholder="Ex: 2" />

    <label class="sp-label" style="margin-top:10px">â±ï¸ Delay mÃ¡ximo (segundos)</label>
    <input id="sp_delay_max" type="number" class="sp-input" min="0" step="0.5" placeholder="Ex: 6" />

    <div class="sp-row" style="margin-top:10px">
      <button id="sp_save_settings" class="sp-btn sp-btn-primary" style="flex:1">ğŸ’¾ Salvar</button>
      <button id="sp_reload_settings" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ”„ Recarregar</button>
    </div>

    <div id="sp_config_status" class="sp-status">Pronto.</div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“… Agendamentos</div>
    <div class="sp-muted">Agende mÃºltiplas campanhas para horÃ¡rios diferentes.</div>
    
    <div class="sp-row" style="margin-top:10px">
      <input id="sp_schedule_name" class="sp-input" placeholder="Nome da campanha" style="flex:2">
      <input id="sp_schedule_time" type="datetime-local" class="sp-input" style="flex:2">
      <button id="sp_add_schedule" class="sp-btn sp-btn-primary" style="white-space:nowrap">â• Agendar</button>
    </div>
    
    <div id="sp_schedules_list" class="sp-queue-container" style="margin-top:8px;max-height:250px"></div>
    <div id="sp_schedule_status" class="sp-status"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ›¡ï¸ Anti-Ban Inteligente</div>
    <div class="sp-muted">ProteÃ§Ã£o contra bloqueios com delays inteligentes e limite diÃ¡rio.</div>
    
    <label class="sp-label">Limite diÃ¡rio de mensagens</label>
    <input id="sp_daily_limit" type="number" class="sp-input" value="200" min="1" max="1000">
    
    <div class="sp-row" style="margin-top:8px">
      <span class="sp-muted">Enviadas hoje: <b id="sp_sent_today">0</b> / <b id="sp_daily_limit_display">200</b></span>
    </div>
    
    <div id="sp_daily_progress" style="height:8px;background:rgba(255,255,255,0.1);border-radius:4px;margin-top:8px">
      <div id="sp_daily_progress_fill" style="height:100%;width:0%;background:#25D366;border-radius:4px;transition:width 0.3s"></div>
    </div>
    
    <label class="sp-checkbox" style="margin-top:10px">
      <input type="checkbox" id="sp_business_hours_only">
      <span>Enviar apenas em horÃ¡rio comercial (8h-20h)</span>
    </label>
    
    <div class="sp-row" style="margin-top:10px">
      <button id="sp_save_antiban" class="sp-btn sp-btn-primary">ğŸ’¾ Salvar</button>
      <button id="sp_reset_daily_count" class="sp-btn sp-btn-secondary">ğŸ”„ Resetar contador</button>
    </div>
    
    <div id="sp_antiban_status" class="sp-status"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ”” NotificaÃ§Ãµes</div>
    <div class="sp-muted">Alertas desktop para eventos importantes.</div>
    
    <label class="sp-checkbox">
      <input type="checkbox" id="sp_enable_notifications" checked>
      <span>Ativar notificaÃ§Ãµes desktop</span>
    </label>
    
    <label class="sp-checkbox">
      <input type="checkbox" id="sp_enable_sounds" checked>
      <span>Ativar sons</span>
    </label>
    
    <button id="sp_test_notification" class="sp-btn sp-btn-secondary" style="margin-top:8px">ğŸ”” Testar NotificaÃ§Ã£o</button>
    <div id="sp_notification_status" class="sp-status"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“ Templates</div>
    <div class="sp-muted">Salva e restaura fila, mensagem, imagem e contatos extraÃ­dos. Suporte a variÃ¡veis dinÃ¢micas.</div>

    <div class="sp-row" style="align-items:center">
      <input id="sp_draft_name" type="text" class="sp-input" placeholder="Nome do template" />
      <button id="sp_save_draft" class="sp-btn sp-btn-primary" style="white-space:nowrap">Salvar</button>
    </div>
    
    <div class="sp-muted" style="margin-top:8px;font-size:11px">
      ğŸ“Œ VariÃ¡veis disponÃ­veis: {nome}, {empresa}, {data}, {hora}, {numero}, {saudacao}
    </div>

    <div class="sp-queue-container" style="margin-top:8px;max-height:36vh">
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th style="width:92px">Data</th>
            <th style="width:52px">#</th>
            <th style="width:92px">AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody id="sp_drafts_body"></tbody>
      </table>
    </div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“„ RelatÃ³rio</div>
    <div class="sp-muted">Exportar CSV da fila e copiar falhas.</div>

    <div class="sp-row">
      <button id="sp_export_report" class="sp-btn sp-btn-secondary" style="flex:1">â¬‡ï¸ Exportar CSV</button>
      <button id="sp_copy_failed" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“‹ Copiar falhas</button>
    </div>

    <div id="sp_report_hint" class="sp-status"></div>
  </div>
</section>

            <!-- ============ VIEW: BACKUP ============ -->
            <section id="whlViewBackup" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">ğŸ’¾ Backup</div>
    <div class="sp-muted">Exporte conversas do WhatsApp Web (HTML/JSON/CSV/TXT) e baixe mÃ­dias em ZIP (opcional).</div>

    <div class="sp-row" style="align-items:center; gap:10px">
      <span id="bk_status_pill" class="sp-pill pending">Verificandoâ€¦</span>
      <span id="bk_status_text" class="sp-muted" style="margin:0">â€”</span>
      <button id="bk_refresh" class="sp-btn sp-btn-secondary" style="margin-left:auto">ğŸ”„ Atualizar</button>
    </div>

    <div id="bk_wrong_page" class="sp-status" style="margin-top:10px; display:none">Abra o WhatsApp Web (web.whatsapp.com) e faÃ§a login.</div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“‡ Selecionar conversa</div>
    <div class="sp-muted">Por padrÃ£o, exporta a conversa aberta no WhatsApp. Se preferir, selecione uma conversa abaixo.</div>

    <div class="sp-row">
      <button id="bk_export_current" class="sp-btn sp-btn-primary" style="flex:1">ğŸ“¤ Exportar conversa atual</button>
    </div>

    <div class="sp-row" style="margin-top:8px">
      <button id="bk_load_contacts" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ”„ Carregar contatos</button>
      <button id="bk_clear_selection" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ§¹ Limpar seleÃ§Ã£o</button>
    </div>

    <label class="sp-label">ğŸ” Buscar</label>
    <input id="bk_search_contacts" class="sp-input" placeholder="Digite para filtrar..." />

    <!-- Ãrea de contato selecionado para backup -->
    <div id="bk_selected_contact_display" class="sp-card" style="margin-top:10px; display:none; background: rgba(37,211,102,0.15); border: 1px solid rgba(37,211,102,0.3);">
      <div style="display:flex; align-items:center; gap:12px;">
        <img id="bk_selected_avatar" src="" alt="Avatar" style="width:48px; height:48px; border-radius:50%; object-fit:cover; display:none;" />
        <div id="bk_selected_avatar_placeholder" style="width:48px; height:48px; border-radius:50%; background:rgba(255,255,255,0.1); display:flex; align-items:center; justify-content:center; font-size:20px;">ğŸ‘¤</div>
        <div style="flex:1;">
          <div id="bk_selected_name" style="font-weight:700; font-size:14px; color:#fff;">Nenhum contato selecionado</div>
          <div id="bk_selected_info" class="sp-muted" style="font-size:12px;">Selecione um contato ou exporte a conversa atual</div>
        </div>
      </div>
    </div>

    <div id="bk_selected_box" class="sp-status" style="margin-top:10px; display:none"></div>

    <div id="bk_contacts_list" class="groups-list" style="margin-top:10px; max-height:320px"></div>
  </div>

  <div class="sp-card">
    <div class="sp-title">âš™ï¸ OpÃ§Ãµes de exportaÃ§Ã£o</div>
    <div class="sp-muted">O download inicia automaticamente. Se selecionar mÃ­dias, serÃ¡ gerado um ZIP por tipo.</div>

    <label class="sp-label">Formato</label>
    <select id="bk_format" class="sp-input">
      <option value="html">HTML (recomendado)</option>
      <option value="json">JSON</option>
      <option value="csv">CSV</option>
      <option value="txt">TXT</option>
    </select>

    <label class="sp-label">Limite de mensagens</label>
    <select id="bk_limit" class="sp-input">
      <option value="100">100</option>
      <option value="500">500</option>
      <option value="1000">1000</option>
      <option value="5000">5000</option>
      <option value="-1">Todas (pode demorar)</option>
    </select>

    <div class="sp-row" style="margin-top:10px">
      <div style="flex:1">
        <label class="sp-label">De (data)</label>
        <input id="bk_date_from" type="date" class="sp-input" />
      </div>
      <div style="flex:1">
        <label class="sp-label">AtÃ© (data)</label>
        <input id="bk_date_to" type="date" class="sp-input" />
      </div>
    </div>

    <label class="sp-checkbox" style="margin-top:10px">
      <input type="checkbox" id="bk_inc_ts" />
      <span>Incluir timestamps</span>
    </label>

    <label class="sp-checkbox">
      <input type="checkbox" id="bk_inc_sender" checked />
      <span>Incluir remetente</span>
    </label>

    <div style="margin-top:12px; padding-top:10px; border-top:1px solid rgba(255,255,255,0.10)">
      <div class="sp-title">ğŸ–¼ï¸ MÃ­dias (opcional)</div>
      <div class="sp-muted">Baixa mÃ­dias da conversa em ZIP. Dependendo do volume, pode demorar.</div>

      <label class="sp-checkbox">
        <input type="checkbox" id="bk_export_images" checked />
        <span>Imagens</span>
      </label>
      <label class="sp-checkbox">
        <input type="checkbox" id="bk_export_videos" />
        <span>VÃ­deos</span>
      </label>
      <label class="sp-checkbox">
        <input type="checkbox" id="bk_export_audios" />
        <span>Ãudios</span>
      </label>
      <label class="sp-checkbox">
        <input type="checkbox" id="bk_export_docs" />
        <span>Documentos</span>
      </label>
    </div>

    <div class="sp-row" style="margin-top:12px">
      <button id="bk_export" class="sp-btn sp-btn-primary" style="flex:1">â¬‡ï¸ Exportar</button>
      <button id="bk_cancel" class="sp-btn sp-btn-secondary" style="flex:1; display:none">â›” Cancelar</button>
    </div>

    <div id="bk_progress_box" style="margin-top:12px; display:none">
      <div class="progress-bar">
        <div id="bk_bar_fill" class="progress-fill" style="width:0%"></div>
        <div id="bk_prog_pct" class="progress-text">0%</div>
      </div>
      <div class="sp-row" style="margin-top:8px; justify-content:space-between; align-items:center">
        <span id="bk_prog_status" class="sp-muted" style="margin:0">â€”</span>
        <span id="bk_prog_detail" class="sp-muted" style="margin:0">0 / 0</span>
      </div>
      <div id="bk_media_progress" class="sp-muted" style="margin-top:8px; font-size:11px; display:none"></div>
    </div>

    <div id="bk_feedback" class="sp-status" style="margin-top:10px">Pronto.</div>
  </div>
</section>

            <!-- ============ VIEW: CRM ============ -->
            <section id="whlViewCrm" class="whl-view hidden">
  <div class="sp-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border: none;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <div class="sp-title" style="color: white;">ğŸ’¼ CRM Kanban</div>
        <div class="sp-muted" style="color: rgba(255,255,255,0.8);">ExperiÃªncia completa em tela cheia</div>
      </div>
      <button id="crm_open_fullscreen" class="sp-btn" style="background: white; color: #8b5cf6; font-weight: 600; padding: 10px 20px;">
        ğŸš€ Abrir em Nova Aba
      </button>
    </div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ’¼ CRM - Pipeline de Vendas</div>
    <div class="sp-muted">Gerencie seus contatos e negÃ³cios em um Kanban visual.</div>

    <div class="sp-row" style="margin-top:12px">
      <button id="crm_new_deal" class="sp-btn sp-btn-primary">â• Novo NegÃ³cio</button>
      <button id="crm_new_contact" class="sp-btn sp-btn-secondary">ğŸ‘¤ Novo Contato</button>
      <button id="crm_refresh" class="sp-btn sp-btn-secondary">ğŸ”„</button>
    </div>
  </div>

  <div class="sp-card" id="crm_kanban_container">
    <!-- Kanban serÃ¡ renderizado aqui pelo mÃ³dulo -->
    <div class="whl-empty">Carregando CRM...</div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ·ï¸ Etiquetas / Labels</div>
    <div class="sp-muted">Organize seus contatos com etiquetas personalizadas.</div>
    <div id="labels_manager_container" style="margin-top:12px">
      <!-- Labels serÃ£o renderizadas aqui -->
    </div>
  </div>

  <div class="sp-card">
    <div class="sp-title">ğŸ“œ Atividades Recentes</div>
    <div id="crm_activities_container">
      <!-- Timeline serÃ¡ renderizada aqui -->
    </div>
  </div>
</section>

            <!-- ============ VIEW: ANALYTICS ============ -->
            <section id="whlViewAnalytics" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">ğŸ“Š Analytics & MÃ©tricas</div>
    <div class="sp-muted">Acompanhe o desempenho das suas campanhas e mensagens.</div>

    <div class="sp-row" style="margin-top:12px">
      <button id="analytics_refresh" class="sp-btn sp-btn-secondary">ğŸ”„ Atualizar</button>
      <button id="analytics_export" class="sp-btn sp-btn-secondary">ğŸ“¤ Exportar</button>
      <button id="analytics_reset" class="sp-btn sp-btn-danger">ğŸ—‘ï¸ Resetar</button>
    </div>
  </div>

  <div id="analytics_dashboard_container">
    <!-- Dashboard serÃ¡ renderizado aqui pelo mÃ³dulo -->
    <div class="whl-empty">Carregando mÃ©tricas...</div>
  </div>
</section>

            <!-- ============ VIEW: TASKS ============ -->
            <section id="whlViewTasks" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">ğŸ“‹ Sistema de Tarefas</div>
    <div class="sp-muted">Gerencie seus lembretes e follow-ups com contatos.</div>
  </div>

  <!-- Stats de Tasks -->
  <div class="sp-card" id="tasks_stats_container" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
    <div style="text-align:center;padding:8px;background:rgba(139,92,246,0.1);border-radius:8px">
      <div style="font-size:20px;font-weight:700" id="stat_total">0</div>
      <div style="font-size:10px;color:var(--sp-muted)">Total</div>
    </div>
    <div style="text-align:center;padding:8px;background:rgba(245,158,11,0.1);border-radius:8px">
      <div style="font-size:20px;font-weight:700;color:#F59E0B" id="stat_pending">0</div>
      <div style="font-size:10px;color:var(--sp-muted)">Pendentes</div>
    </div>
    <div style="text-align:center;padding:8px;background:rgba(239,68,68,0.1);border-radius:8px">
      <div style="font-size:20px;font-weight:700;color:#EF4444" id="stat_overdue">0</div>
      <div style="font-size:10px;color:var(--sp-muted)">Atrasadas</div>
    </div>
    <div style="text-align:center;padding:8px;background:rgba(16,185,129,0.1);border-radius:8px">
      <div style="font-size:20px;font-weight:700;color:#10B981" id="stat_completed">0</div>
      <div style="font-size:10px;color:var(--sp-muted)">ConcluÃ­das</div>
    </div>
  </div>

  <div class="sp-card" id="tasks_container">
    <!-- Lista de tarefas serÃ¡ renderizada aqui pelo mÃ³dulo (inclui filtros e botÃ£o nova tarefa) -->
    <div class="whl-empty">Carregando tarefas...</div>
  </div>
</section>

            <!-- ============ VIEW: SMART REPLIES (IA) ============ -->
            <section id="whlViewAi" class="whl-view hidden">
  <!-- Header com tabs -->
  <div class="sp-card" style="padding: 0; overflow: hidden;">
    <div class="mod-tabs" style="display: flex; border-bottom: 1px solid rgba(255,255,255,0.1);">
      <button class="mod-tab active" data-ai-tab="copilot" style="flex:1; padding: 12px; background: transparent; border: none; color: var(--mod-text); cursor: pointer; border-bottom: 2px solid var(--mod-primary);">
        ğŸ¤– Copilot
      </button>
      <button class="mod-tab" data-ai-tab="providers" style="flex:1; padding: 12px; background: transparent; border: none; color: var(--mod-text-muted); cursor: pointer;">
        ğŸ”Œ Providers
      </button>
      <button class="mod-tab" data-ai-tab="knowledge" style="flex:1; padding: 12px; background: transparent; border: none; color: var(--mod-text-muted); cursor: pointer;">
        ğŸ“š Knowledge
      </button>
    </div>
  </div>

  <!-- Tab: Copilot -->
  <div id="aiTabCopilot" class="ai-tab-content">
    <div class="sp-card">
      <div class="sp-title">ğŸ¤– CopilotEngine - Assistente Inteligente</div>
      <div class="sp-muted">Respostas automÃ¡ticas baseadas em contexto, intenÃ§Ã£o e sentimento.</div>
      
      <!-- Indicador de modo atual -->
      <div id="copilot_mode_indicator" style="display: inline-flex; align-items: center; gap: 6px; margin-top: 12px; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: rgba(16,185,129,0.2); color: #10b981;">
        ğŸ’¡ SugestÃµes
      </div>
      
      <div style="margin-top: 12px;">
        <label class="mod-label">Modo de OperaÃ§Ã£o</label>
        <select id="copilot_mode" class="mod-input mod-select">
          <option value="off">ğŸ”´ Desativado</option>
          <option value="suggest" selected>ğŸ’¡ SugestÃ£o - Mostra sugestÃµes</option>
          <option value="semi_auto">âš¡ Semi-automÃ¡tico - Envia apÃ³s aprovaÃ§Ã£o</option>
          <option value="full_auto">ğŸ¤– AutomÃ¡tico - Responde sozinho</option>
        </select>
      </div>

      <div style="margin-top: 12px;">
        <label class="mod-label">Persona do Assistente</label>
        <div id="copilot_personas" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 8px;">
          <label class="mod-card persona-card active" data-persona="professional" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ‘” Profissional</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">Formal e objetivo</div>
          </label>
          <label class="mod-card persona-card" data-persona="friendly" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ˜Š AmigÃ¡vel</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">DescontraÃ­do</div>
          </label>
          <label class="mod-card persona-card" data-persona="sales" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ’¼ Vendas</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">Persuasivo</div>
          </label>
          <label class="mod-card persona-card" data-persona="support" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ› ï¸ Suporte</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">TÃ©cnico</div>
          </label>
          <label class="mod-card persona-card" data-persona="concierge" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ© Concierge</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">Premium</div>
          </label>
          <label class="mod-card persona-card" data-persona="coach" style="padding: 10px; cursor: pointer;">
            <div style="font-weight: 600;">ğŸ† Coach</div>
            <div style="font-size: 11px; color: var(--mod-text-muted);">Motivador</div>
          </label>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ§ª Testar AnÃ¡lise</div>
      <textarea id="copilot_test_input" class="mod-input" rows="2" placeholder="Digite uma mensagem para analisar..."></textarea>
      <button id="copilot_analyze_btn" class="mod-btn mod-btn-primary" style="margin-top: 8px; width: 100%;">ğŸ” Analisar Mensagem</button>
      
      <div id="copilot_analysis_result" style="display: none; margin-top: 12px;">
        <div class="mod-card" style="background: rgba(139,92,246,0.1);">
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center;">
            <div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">IntenÃ§Ã£o</div>
              <div id="analysis_intent" style="font-weight: 600;">-</div>
            </div>
            <div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">Sentimento</div>
              <div id="analysis_sentiment" style="font-weight: 600;">-</div>
            </div>
            <div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">ConfianÃ§a</div>
              <div id="analysis_confidence" style="font-weight: 600;">-</div>
            </div>
          </div>
          <div style="margin-top: 8px;">
            <div style="font-size: 11px; color: var(--mod-text-muted);">Entidades Detectadas</div>
            <div id="analysis_entities" style="font-size: 12px;">-</div>
          </div>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>ğŸ’¡ SugestÃµes de Resposta</span>
        <button id="btn_show_suggestions_panel" class="btn-primary" style="padding: 4px 12px; font-size: 11px;">
          ğŸ“¤ Mostrar na Tela
        </button>
      </div>
      <div id="copilot_suggestions" class="sp-muted">
        As sugestÃµes aparecerÃ£o aqui quando vocÃª receber mensagens.
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ“Š MÃ©tricas do Copilot</div>
      <div id="copilot_metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="metric_total_responses">0</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Respostas</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="metric_auto_responses">0</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">AutomÃ¡ticas</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="metric_avg_confidence">0%</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">ConfianÃ§a MÃ©dia</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="metric_feedback_score">-</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Feedback</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab: Providers -->
  <div id="aiTabProviders" class="ai-tab-content" style="display: none;">
    <div class="sp-card">
      <div class="sp-title">ğŸ”Œ AIService - Multi-Provider</div>
      <div class="sp-muted">Configure mÃºltiplos providers de IA com fallback automÃ¡tico.</div>
    </div>

    <div id="ai_providers_list">
      <!-- Provider: OpenAI -->
      <div class="sp-card provider-card" data-provider="openai">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">ğŸŸ¢</span>
            <div>
              <div style="font-weight: 600;">OpenAI</div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">GPT-4o, GPT-4o Mini</div>
            </div>
          </div>
          <label class="mod-switch">
            <input type="checkbox" id="provider_openai_enabled">
            <span class="mod-switch-slider"></span>
          </label>
        </div>
        <div class="provider-config" style="margin-top: 12px; display: none;">
          <input type="password" id="provider_openai_key" class="mod-input" placeholder="sk-..." style="margin-bottom: 8px;">
          <select id="provider_openai_model" class="mod-input mod-select">
            <option value="gpt-4o-mini">GPT-4o Mini (Recomendado)</option>
            <option value="gpt-4o">GPT-4o</option>
            <option value="gpt-4-turbo">GPT-4 Turbo</option>
          </select>
        </div>
      </div>

      <!-- Provider: Anthropic -->
      <div class="sp-card provider-card" data-provider="anthropic">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">ğŸŸ </span>
            <div>
              <div style="font-weight: 600;">Anthropic</div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">Claude 3.5 Sonnet, Haiku</div>
            </div>
          </div>
          <label class="mod-switch">
            <input type="checkbox" id="provider_anthropic_enabled">
            <span class="mod-switch-slider"></span>
          </label>
        </div>
        <div class="provider-config" style="margin-top: 12px; display: none;">
          <input type="password" id="provider_anthropic_key" class="mod-input" placeholder="sk-ant-..." style="margin-bottom: 8px;">
          <select id="provider_anthropic_model" class="mod-input mod-select">
            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
            <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
          </select>
        </div>
      </div>

      <!-- Provider: Groq -->
      <div class="sp-card provider-card" data-provider="groq">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">âš¡</span>
            <div>
              <div style="font-weight: 600;">Groq</div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">Llama 3.3 70B (Ultra-rÃ¡pido)</div>
            </div>
          </div>
          <label class="mod-switch">
            <input type="checkbox" id="provider_groq_enabled">
            <span class="mod-switch-slider"></span>
          </label>
        </div>
        <div class="provider-config" style="margin-top: 12px; display: none;">
          <input type="password" id="provider_groq_key" class="mod-input" placeholder="gsk_..." style="margin-bottom: 8px;">
          <select id="provider_groq_model" class="mod-input mod-select">
            <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
            <option value="llama-3.1-8b-instant">Llama 3.1 8B (Mais rÃ¡pido)</option>
          </select>
        </div>
      </div>

      <!-- Provider: Venice -->
      <div class="sp-card provider-card" data-provider="venice">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 20px;">ğŸ­</span>
            <div>
              <div style="font-weight: 600;">Venice AI</div>
              <div style="font-size: 11px; color: var(--mod-text-muted);">Llama 3.3, DeepSeek R1</div>
            </div>
          </div>
          <label class="mod-switch">
            <input type="checkbox" id="provider_venice_enabled">
            <span class="mod-switch-slider"></span>
          </label>
        </div>
        <div class="provider-config" style="margin-top: 12px; display: none;">
          <input type="password" id="provider_venice_key" class="mod-input" placeholder="API Key" style="margin-bottom: 8px;">
          <select id="provider_venice_model" class="mod-input mod-select">
            <option value="llama-3.3-70b">Llama 3.3 70B</option>
            <option value="deepseek-r1-llama-70b">DeepSeek R1 70B</option>
          </select>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <button id="ai_save_providers" class="mod-btn mod-btn-primary" style="width: 100%;">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button>
      <button id="ai_test_provider" class="mod-btn mod-btn-secondary" style="width: 100%; margin-top: 8px;">ğŸ§ª Testar Provider Ativo</button>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ“Š EstatÃ­sticas de Uso</div>
      <div id="ai_usage_stats" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="ai_stat_requests">0</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">RequisiÃ§Ãµes</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="ai_stat_tokens">0</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Tokens</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="ai_stat_success">0%</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Sucesso</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 600;" id="ai_stat_cost">$0.00</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Custo Est.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab: Knowledge Base -->
  <div id="aiTabKnowledge" class="ai-tab-content" style="display: none;">
    <div class="sp-card">
      <div class="sp-title">ğŸ“š Base de Conhecimento</div>
      <div class="sp-muted">Adicione FAQs e informaÃ§Ãµes que a IA usarÃ¡ nas respostas.</div>
    </div>

    <div class="sp-card">
      <div class="sp-title">â• Adicionar FAQ</div>
      <input type="text" id="kb_question" class="mod-input" placeholder="Pergunta..." style="margin-bottom: 8px;">
      <textarea id="kb_answer" class="mod-input" rows="2" placeholder="Resposta..."></textarea>
      <button id="kb_add_btn" class="mod-btn mod-btn-primary" style="width: 100%; margin-top: 8px;">â• Adicionar</button>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ“‹ FAQs Cadastradas</div>
      <div id="kb_list" style="max-height: 300px; overflow-y: auto;">
        <div class="sp-muted">Nenhuma FAQ cadastrada.</div>
      </div>
    </div>
  </div>
</section>

            <!-- ============ VIEW: BACKEND ============ -->
            <section id="whlViewBackend" class="whl-view hidden">
  <div class="sp-card">
    <div class="sp-title">ğŸŒ Backend - SincronizaÃ§Ã£o Enterprise</div>
    <div class="sp-muted">Conecte ao servidor backend para sincronizar dados em tempo real.</div>
  </div>

  <!-- Status de ConexÃ£o -->
  <div class="sp-card" id="backend_status_card">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <span id="backend_status_icon" style="font-size: 24px;">ğŸ”´</span>
        <div>
          <div id="backend_status_text" style="font-weight: 600;">Desconectado</div>
          <div id="backend_status_detail" style="font-size: 11px; color: var(--mod-text-muted);">Configure a conexÃ£o abaixo</div>
        </div>
      </div>
      <button id="backend_disconnect_btn" class="mod-btn mod-btn-danger" style="display: none;">Desconectar</button>
    </div>
  </div>

  <!-- Form de Login/Registro -->
  <div id="backend_auth_form">
    <div class="sp-card">
      <div class="sp-title">ğŸ”— Conectar ao Backend</div>
      
      <div style="margin-bottom: 12px;">
        <label class="mod-label">URL do Servidor</label>
        <input type="text" id="backend_url" class="mod-input" placeholder="http://localhost:3000" value="http://localhost:3000">
      </div>

      <div class="mod-tabs" style="display: flex; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden;">
        <button class="backend-auth-tab active" data-tab="login" style="flex: 1; padding: 8px; background: rgba(139,92,246,0.2); border: none; color: var(--mod-text); cursor: pointer;">
          ğŸ”‘ Login
        </button>
        <button class="backend-auth-tab" data-tab="register" style="flex: 1; padding: 8px; background: transparent; border: none; color: var(--mod-text-muted); cursor: pointer;">
          ğŸ“ Registrar
        </button>
      </div>

      <!-- Login Form -->
      <div id="backend_login_form">
        <div style="margin-bottom: 8px;">
          <label class="mod-label">Email</label>
          <input type="email" id="backend_login_email" class="mod-input" placeholder="seu@email.com">
        </div>
        <div style="margin-bottom: 12px;">
          <label class="mod-label">Senha</label>
          <input type="password" id="backend_login_password" class="mod-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
        <button id="backend_login_btn" class="mod-btn mod-btn-primary" style="width: 100%;">ğŸ”‘ Entrar</button>
      </div>

      <!-- Register Form -->
      <div id="backend_register_form" style="display: none;">
        <div style="margin-bottom: 8px;">
          <label class="mod-label">Nome</label>
          <input type="text" id="backend_register_name" class="mod-input" placeholder="Seu nome">
        </div>
        <div style="margin-bottom: 8px;">
          <label class="mod-label">Email</label>
          <input type="email" id="backend_register_email" class="mod-input" placeholder="seu@email.com">
        </div>
        <div style="margin-bottom: 12px;">
          <label class="mod-label">Senha</label>
          <input type="password" id="backend_register_password" class="mod-input" placeholder="MÃ­nimo 8 caracteres">
        </div>
        <button id="backend_register_btn" class="mod-btn mod-btn-primary" style="width: 100%;">ğŸ“ Criar Conta</button>
      </div>

      <div id="backend_auth_error" style="display: none; margin-top: 12px; padding: 8px; background: rgba(239,68,68,0.2); border-radius: 8px; color: #ef4444; font-size: 12px;"></div>
    </div>
  </div>

  <!-- Painel Conectado -->
  <div id="backend_connected_panel" style="display: none;">
    <div class="sp-card">
      <div class="sp-title">ğŸ‘¤ UsuÃ¡rio Conectado</div>
      <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
        <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--mod-primary), var(--mod-accent)); display: flex; align-items: center; justify-content: center; font-size: 20px;">
          ğŸ‘¤
        </div>
        <div>
          <div id="backend_user_name" style="font-weight: 600;">-</div>
          <div id="backend_user_email" style="font-size: 12px; color: var(--mod-text-muted);">-</div>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ¢ Workspace</div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 8px;">
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 11px; color: var(--mod-text-muted);">Plano</div>
          <div id="backend_workspace_plan" style="font-weight: 600;">-</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 11px; color: var(--mod-text-muted);">CrÃ©ditos IA</div>
          <div id="backend_workspace_credits" style="font-weight: 600;">-</div>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ”„ SincronizaÃ§Ã£o</div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 8px;">
        <button id="backend_sync_contacts" class="mod-btn mod-btn-secondary">
          ğŸ‘¥ Sync Contatos
        </button>
        <button id="backend_sync_deals" class="mod-btn mod-btn-secondary">
          ğŸ’¼ Sync Deals
        </button>
        <button id="backend_sync_tasks" class="mod-btn mod-btn-secondary">
          âœ… Sync Tarefas
        </button>
        <button id="backend_sync_all" class="mod-btn mod-btn-primary">
          ğŸ”„ Sync Tudo
        </button>
      </div>
      <div id="backend_sync_status" style="margin-top: 8px; font-size: 12px; color: var(--mod-text-muted);"></div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ“Š Dados Sincronizados</div>
      <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 8px;">
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 18px; font-weight: 600;" id="backend_count_contacts">0</div>
          <div style="font-size: 10px; color: var(--mod-text-muted);">Contatos</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 18px; font-weight: 600;" id="backend_count_deals">0</div>
          <div style="font-size: 10px; color: var(--mod-text-muted);">Deals</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 18px; font-weight: 600;" id="backend_count_tasks">0</div>
          <div style="font-size: 10px; color: var(--mod-text-muted);">Tarefas</div>
        </div>
        <div class="mod-card" style="padding: 8px; text-align: center;">
          <div style="font-size: 18px; font-weight: 600;" id="backend_count_templates">0</div>
          <div style="font-size: 10px; color: var(--mod-text-muted);">Templates</div>
        </div>
      </div>
    </div>

    <div class="sp-card">
      <div class="sp-title">ğŸ”Œ WebSocket</div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <span id="backend_ws_status" style="font-size: 16px;">ğŸ”´</span>
        <span id="backend_ws_text" style="font-size: 12px;">Desconectado</span>
      </div>
      <div id="backend_ws_hint" style="font-size: 11px; color: var(--mod-text-muted); margin-top: 4px;">
        âš ï¸ FaÃ§a login acima para ativar a sincronizaÃ§Ã£o em tempo real
      </div>
      <div style="font-size: 10px; color: var(--mod-text-muted); margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.05);">
        Real-time sync para: contatos, deals, tarefas, mensagens
      </div>
    </div>
  </div>
</section>

            <!-- ============ VIEW: AUTO-PILOT ============ -->
            <section id="whlViewAutoPilot" class="whl-view hidden">
  <!-- Header -->
  <div class="sp-card" style="background: linear-gradient(135deg, var(--mod-primary) 0%, var(--mod-accent) 100%); border: none;">
    <div style="display: flex; align-items: center; gap: 12px;">
      <span style="font-size: 32px;">ğŸ¤–</span>
      <div>
        <div style="font-size: 18px; font-weight: 700; color: white;">Auto-Pilot IA</div>
        <div style="font-size: 12px; color: rgba(255,255,255,0.8);">Responde automaticamente Ã s mensagens nÃ£o lidas</div>
      </div>
    </div>
  </div>

  <!-- Status Principal -->
  <div class="sp-card" id="autopilot_status_card">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div id="autopilot_status_indicator" style="width: 48px; height: 48px; border-radius: 50%; background: rgba(107, 114, 128, 0.2); display: flex; align-items: center; justify-content: center; font-size: 24px;">
          â¹ï¸
        </div>
        <div>
          <div id="autopilot_status_text" style="font-weight: 600; font-size: 16px;">Parado</div>
          <div id="autopilot_status_detail" style="font-size: 11px; color: var(--mod-text-muted);">Clique em Iniciar para comeÃ§ar</div>
        </div>
      </div>
      <span id="autopilot_status_badge" class="mod-badge" style="background: rgba(107, 114, 128, 0.2); color: #9ca3af; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">
        PARADO
      </span>
    </div>
  </div>

  <!-- EstatÃ­sticas -->
  <div class="sp-card">
    <div class="sp-title">ğŸ“Š EstatÃ­sticas da SessÃ£o</div>
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 12px;">
      <div class="mod-card" style="padding: 12px; text-align: center; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2);">
        <div id="ap_stat_sent" style="font-size: 24px; font-weight: 700; color: #10b981;">0</div>
        <div style="font-size: 10px; color: var(--mod-text-muted); text-transform: uppercase;">Enviadas</div>
      </div>
      <div class="mod-card" style="padding: 12px; text-align: center; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.2);">
        <div id="ap_stat_pending" style="font-size: 24px; font-weight: 700; color: #667eea;">0</div>
        <div style="font-size: 10px; color: var(--mod-text-muted); text-transform: uppercase;">Pendentes</div>
      </div>
      <div class="mod-card" style="padding: 12px; text-align: center; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.2);">
        <div id="ap_stat_skipped" style="font-size: 24px; font-weight: 700; color: #f59e0b;">0</div>
        <div style="font-size: 10px; color: var(--mod-text-muted); text-transform: uppercase;">Puladas</div>
      </div>
      <div class="mod-card" style="padding: 12px; text-align: center; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2);">
        <div id="ap_stat_errors" style="font-size: 24px; font-weight: 700; color: #ef4444;">0</div>
        <div style="font-size: 10px; color: var(--mod-text-muted); text-transform: uppercase;">Erros</div>
      </div>
    </div>

    <!-- Barra de progresso -->
    <div style="margin-top: 12px;">
      <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
        <span style="color: var(--mod-text-muted);">Respostas esta hora</span>
        <span id="ap_progress_text" style="color: var(--mod-text);">0 / 30</span>
      </div>
      <div style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
        <div id="ap_progress_bar" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--mod-primary), var(--mod-accent)); border-radius: 3px; transition: width 0.3s;"></div>
      </div>
    </div>
  </div>

  <!-- Controles Principais -->
  <div class="sp-card">
    <div class="sp-title">ğŸ® Controles</div>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 12px;">
      <button id="ap_btn_start" class="mod-btn mod-btn-primary" style="padding: 14px; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <span>â–¶ï¸</span> Iniciar
      </button>
      <button id="ap_btn_pause" class="mod-btn mod-btn-secondary" style="padding: 14px; font-size: 14px; display: none; align-items: center; justify-content: center; gap: 8px; background: rgba(245, 158, 11, 0.2); border-color: rgba(245, 158, 11, 0.3); color: #f59e0b;">
        <span>â¸ï¸</span> Pausar
      </button>
      <button id="ap_btn_resume" class="mod-btn mod-btn-primary" style="padding: 14px; font-size: 14px; display: none; align-items: center; justify-content: center; gap: 8px;">
        <span>â–¶ï¸</span> Continuar
      </button>
      <button id="ap_btn_stop" class="mod-btn mod-btn-danger" style="padding: 14px; font-size: 14px; display: none; align-items: center; justify-content: center; gap: 8px;">
        <span>â¹ï¸</span> Parar
      </button>
    </div>
  </div>

  <!-- ConfiguraÃ§Ãµes -->
  <div class="sp-card">
    <div class="sp-title">âš™ï¸ ConfiguraÃ§Ãµes</div>
    
    <div style="margin-top: 12px;">
      <!-- Pular Grupos -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
        <div>
          <div style="font-size: 13px; font-weight: 500;">Pular grupos</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Ignora mensagens de grupos</div>
        </div>
        <label class="mod-toggle">
          <input type="checkbox" id="ap_config_skip_groups" checked>
          <span class="mod-toggle-slider"></span>
        </label>
      </div>

      <!-- Limite por hora -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
        <div>
          <div style="font-size: 13px; font-weight: 500;">Limite por hora</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">ProteÃ§Ã£o anti-ban</div>
        </div>
        <select id="ap_config_limit" class="mod-select" style="width: 80px; padding: 6px 8px; font-size: 12px;">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="30" selected>30</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>

      <!-- Delay entre chats -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
        <div>
          <div style="font-size: 13px; font-weight: 500;">Delay entre chats</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Tempo de espera em segundos</div>
        </div>
        <select id="ap_config_delay" class="mod-select" style="width: 80px; padding: 6px 8px; font-size: 12px;">
          <option value="2000">2s</option>
          <option value="3000" selected>3s</option>
          <option value="5000">5s</option>
          <option value="10000">10s</option>
        </select>
      </div>

      <!-- HorÃ¡rio de funcionamento -->
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px 0;">
        <div>
          <div style="font-size: 13px; font-weight: 500;">HorÃ¡rio de funcionamento</div>
          <div style="font-size: 11px; color: var(--mod-text-muted);">Ativo apenas nesse perÃ­odo</div>
        </div>
        <label class="mod-toggle">
          <input type="checkbox" id="ap_config_working_hours">
          <span class="mod-toggle-slider"></span>
        </label>
      </div>

      <div id="ap_working_hours_config" style="display: none; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 8px; margin-top: 8px;">
        <div style="display: flex; gap: 12px; align-items: center;">
          <div style="flex: 1;">
            <label style="font-size: 11px; color: var(--mod-text-muted);">InÃ­cio</label>
            <input type="time" id="ap_config_start_time" value="08:00" class="mod-input" style="padding: 6px 8px; font-size: 12px;">
          </div>
          <div style="flex: 1;">
            <label style="font-size: 11px; color: var(--mod-text-muted);">Fim</label>
            <input type="time" id="ap_config_end_time" value="22:00" class="mod-input" style="padding: 6px 8px; font-size: 12px;">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Log de Atividades -->
  <div class="sp-card">
    <div class="sp-title" style="display: flex; align-items: center; justify-content: space-between;">
      <span>ğŸ“‹ Log de Atividades</span>
      <button id="ap_clear_log" class="mod-btn mod-btn-secondary" style="padding: 4px 10px; font-size: 11px;">Limpar</button>
    </div>
    <div id="ap_activity_log" style="max-height: 200px; overflow-y: auto; margin-top: 10px; font-size: 12px; font-family: monospace;">
      <div style="padding: 8px; color: var(--mod-text-muted); text-align: center;">
        Nenhuma atividade ainda
      </div>
    </div>
  </div>

  <!-- Blacklist/Whitelist -->
  <div class="sp-card">
    <div class="sp-title">ğŸš« Lista de ExclusÃ£o</div>
    <div style="font-size: 11px; color: var(--mod-text-muted); margin-bottom: 10px;">
      Contatos que serÃ£o ignorados pelo Auto-Pilot
    </div>
    <div id="ap_blacklist" style="min-height: 40px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 8px;">
      <div style="color: var(--mod-text-muted); font-size: 11px; text-align: center;">
        Nenhum contato na lista
      </div>
    </div>
    <button id="ap_add_current_to_blacklist" class="mod-btn mod-btn-secondary" style="width: 100%; margin-top: 10px; font-size: 12px;">
      â• Adicionar chat atual Ã  lista
    </button>
  </div>
</section>

        </div>



        <!-- ========================================
             FOOTER
        ======================================== -->
        <footer class="footer">
            <span class="footer-text">
                WhatsApp Group Member Extractor
            </span>
        </footer>
    </div>

    <!-- ========================================
         SCRIPTS - SEM type="module"
    ======================================== -->
    <!-- SheetJS: Removido por CSP. Excel import usa alternativa local se disponÃ­vel -->
    
    <!-- Utilities -->
    <script src="utils/utils-optimized.js"></script>
    <script src="utils/storage.js"></script>
    <script src="utils/google-sheets-export.js"></script>
    <script src="utils/templates.js"></script>
    
    <!-- New advanced utilities -->
    <script src="utils/scheduler.js"></script>
    <script src="utils/anti-ban.js"></script>
    <script src="utils/contact-importer.js"></script>
    <script src="utils/group-cache.js"></script>
    <script src="utils/notifications.js"></script>
    
    <!-- Modules - Sistema completo baseado no Quantum CRM -->
    <!-- ===============================================
         CORE SYSTEMS - EventBus v2.0 & StateManager v1.0
    =============================================== -->
    <script src="modules/event-bus.js"></script>
    <script src="modules/state-manager.js"></script>
    <script src="modules/modern-ui.js"></script>
    
    <!-- ===============================================
         AI SYSTEMS - AIService v1.0 & CopilotEngine v1.0
    =============================================== -->
    <script src="modules/ai-service.js"></script>
    <script src="modules/copilot-engine.js"></script>
    
    <!-- ===============================================
         BACKEND - BackendClient v1.0
    =============================================== -->
    <script src="modules/backend-client.js"></script>
    
    <!-- ===============================================
         HANDLERS - AI & Backend UI
    =============================================== -->
    <script src="modules/ai-backend-handlers.js"></script>
    
    <!-- Modules -->
    <script src="modules/chart-engine.js"></script>
    <script src="modules/notifications.js"></script>
    <script src="modules/analytics.js"></script>
    <script src="modules/crm.js"></script>
    <script src="modules/tasks.js"></script>
    <script src="modules/smart-replies.js"></script>
    <script src="modules/subscription.js"></script>
    <script src="modules/labels.js"></script>
    <!-- Injetores sÃ£o carregados no content script, nÃ£o no sidepanel -->
    <script src="modules/init.js"></script>
    
    <!-- Tests (Ctrl+Shift+T para executar) -->
    <script src="tests/regression-tests.js"></script>
    <script src="tests/ai-copilot-tests.js"></script>
    
    <!-- Core scripts -->
    <script src="onboarding.js"></script>
    <script src="modules/audio-file-handler.js"></script>
    <script src="modules/human-typing.js"></script>
    <script src="sidepanel.js"></script>
    <script src="modules/recover-advanced.js"></script>
    <script src="sidepanel-router.js"></script>
    <script src="sidepanel-fixes.js"></script>
    
    <!-- Fix: Garantir texto branco em TODAS as Ã¡reas com fundo colorido -->
    <style>
        /* ===== REGRA GLOBAL: Todo texto deve ser branco ===== */
        
        /* Ãrea de teste da IA */
        #ai_test_output,
        #ai_test_output *,
        #ai_test_result,
        #ai_test_result * {
            color: white !important;
        }
        #ai_test_output {
            background: rgba(139, 92, 246, 0.1) !important;
        }
        
        /* Todos os inputs, textareas e selects */
        input, textarea, select,
        .sp-input, .sp-textarea, .sp-select,
        .mod-input, .mod-textarea, .mod-select {
            color: white !important;
        }
        
        /* Todos os containers de cards e resultados */
        .sp-card, .mod-card,
        .sp-card *, .mod-card * {
            color: white;
        }
        
        /* Areas de resultado/output especÃ­ficas */
        [id*="result"], [id*="output"], [id*="preview"],
        [class*="result"], [class*="output"], [class*="preview"] {
            color: white !important;
        }
        
        /* Modais */
        .mod-modal, .mod-modal *,
        [class*="modal"], [class*="modal"] * {
            color: white;
        }
        
        /* Corrigir qualquer texto que herda preto */
        .whl-view, .whl-view *,
        .sp-section, .sp-section *,
        .section-content, .section-content * {
            color: inherit;
        }
        
        /* Placeholders mais visÃ­veis */
        ::placeholder {
            color: rgba(255, 255, 255, 0.5) !important;
        }
        
        /* Labels e textos auxiliares */
        label, .sp-label, .mod-label {
            color: rgba(255, 255, 255, 0.7) !important;
        }
        
        /* BotÃµes com fundo amarelo/claro - usar texto escuro */
        .btn-control-pause,
        [style*="background: yellow"],
        [style*="background:#ff"],
        [style*="background: #ff"] {
            color: #1a1a2e !important;
            text-shadow: none !important;
        }
        
        /* Smart Replies floating panel */
        .sr-floating-panel, .sr-floating-panel *,
        .sr-suggestion-text, .sr-correction-input {
            color: white !important;
        }
        
        /* Garantir contraste em badges */
        .mod-badge, .whl-label-badge {
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
    </style>
    
    <!-- Initialize Modules - v49 com mÃ³dulos funcionais -->
    <script src="sidepanel-handlers.js"></script>
    
    <!-- SmartBot IA System v7.2.0 -->
    <script src="modules/smartbot-ia.js"></script>
    <script src="modules/smartbot-integration.js"></script>
    <script src="modules/smartbot-extended.js"></script>
    <script src="modules/smartbot-ai-plus.js"></script>
    <script src="modules/smartbot-autopilot.js"></script>
    <script src="modules/autopilot-handlers.js"></script>

    <!-- ============================================
         RECOVER - UI DE FILTROS v7.5.0
         ============================================ -->
    <div id="sp_recover_filters" class="sp-card" style="display:none">
      <div class="sp-title">ğŸ” Filtros do Recover</div>
      
      <div class="sp-row" style="margin-top:10px;gap:6px;flex-wrap:wrap">
        <button id="recover_filter_all" class="sp-btn sp-btn-secondary sp-btn-sm active" data-filter="all">ğŸ“‹ Todas</button>
        <button id="recover_filter_revoked" class="sp-btn sp-btn-secondary sp-btn-sm" data-filter="revoked">âŒ Revogadas</button>
        <button id="recover_filter_deleted" class="sp-btn sp-btn-secondary sp-btn-sm" data-filter="deleted">ğŸ—‘ï¸ Apagadas</button>
        <button id="recover_filter_edited" class="sp-btn sp-btn-secondary sp-btn-sm" data-filter="edited">âœï¸ Editadas</button>
        <button id="recover_filter_media" class="sp-btn sp-btn-secondary sp-btn-sm" data-filter="media">ğŸ“ MÃ­dias</button>
      </div>
      
      <div class="sp-row" style="margin-top:10px;gap:6px">
        <input type="text" id="recover_filter_chat" class="sp-input" placeholder="Filtrar por nÃºmero..." style="flex:1">
      </div>
      
      <div class="sp-row" style="margin-top:10px;gap:6px">
        <input type="date" id="recover_filter_from" class="sp-input" style="flex:1">
        <input type="date" id="recover_filter_to" class="sp-input" style="flex:1">
      </div>
      
      <div class="sp-row" style="margin-top:10px;gap:6px">
        <button id="recover_export_csv_2" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“Š CSV</button>
        <button id="recover_export_txt_2" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“ TXT</button>
        <button id="recover_export_pdf_2" class="sp-btn sp-btn-secondary" style="flex:1">ğŸ“„ PDF</button>
      </div>
      
      <div id="recover_stats" class="sp-muted" style="margin-top:10px;font-size:11px">
        Total: <span id="recover_stat_total">0</span> |
        Revogadas: <span id="recover_stat_revoked">0</span> |
        Apagadas: <span id="recover_stat_deleted">0</span> |
        Editadas: <span id="recover_stat_edited">0</span>
      </div>
      
      <!-- CORREÃ‡ÃƒO 4.2: EstatÃ­sticas de sentimento -->
      <div id="recover_sentiment_stats" class="sp-muted" style="margin-top:6px;font-size:11px">
        ğŸ™‚ 0  ğŸ˜ 0  ğŸ™ 0
      </div>
      
      <div id="recover_messages_list" style="margin-top:10px;max-height:300px;overflow-y:auto">
        <!-- Mensagens serÃ£o renderizadas aqui -->
      </div>
      
      <div class="sp-row" style="margin-top:10px;gap:6px">
        <button id="recover_prev_page_2" class="sp-btn sp-btn-secondary sp-btn-sm" disabled>â—€ Anterior</button>
        <span id="recover_page_info_2" class="sp-muted" style="flex:1;text-align:center">PÃ¡gina 1</span>
        <button id="recover_next_page_2" class="sp-btn sp-btn-secondary sp-btn-sm">PrÃ³xima â–¶</button>
      </div>
    </div>


    <!-- CORREÃ‡ÃƒO 2.4: Adicionar jsPDF para exportaÃ§Ã£o PDF -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

</body>
</html>
